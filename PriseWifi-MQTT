import paho.mqtt.client as mqtt #import the client1
import time
relait="ON"

domaine="MuraPentHouse/"
topicPrise="toaster"

broker_address="192.168.0.50"

client = mqtt.Client("Prise") #create new instance
client.connect(broker_address) #connect to broker
client.subscribe(domaine+"status")
client.subscribe(domaine+topicPrise)
def rcv(client, userdata, message):
                global relait
                tmp=str(message.payload.decode("utf-8"))
                if(message.topic == domaine+"toaster"):
                        if(tmp ==  "ON"):
                                relait="ON"
                        if(tmp == "OFF"):
                                relait="OFF"
                        print(relait)
                if(message.topic == domaine+"status"):
                        if(tmp == "GET"):
                                client.publish(domaine+"status",relait)#publish
                                print(relait)
client.loop_start() #start the loop
client.on_message=rcv
time.sleep(99999) # wait
client.loop_stop()
